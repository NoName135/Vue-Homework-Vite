import{m as V}from"./modalMixin-21136f61.js";import{_ as O,o as s,c as o,b as t,u as n,j as f,F as u,s as g,q as M,t as v,m as h,a as y,l as E,d as m,r as b,n as P}from"./index-3168ab36.js";import{o as k,d as S,m as D}from"./DeleteModal-df886aa5.js";import{p as T}from"./Pagination-46aa8bd6.js";import{s as I}from"./swalStore-be32231f.js";const L={props:{order:{type:Object,default(){return{}}}},data(){return{modal:"",tempOrder:{}}},mixins:[V],watch:{order(){this.tempOrder=this.order}}},A={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},U={class:"modal-dialog modal-xl",role:"document"},j={class:"modal-content border-0"},R=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),B={class:"modal-body"},q={class:"row"},H={class:"col-md-4"},N=t("h3",null,"用戶資料",-1),F={class:"table"},z={key:0},G=t("th",{style:{width:"100px"}},"姓名",-1),J=t("th",null,"Email",-1),K=t("th",null,"電話",-1),Q=t("th",null,"地址",-1),W={class:"col-md-8"},X=t("h3",null,"訂單細節",-1),Y={class:"table"},Z=t("th",{style:{width:"100px"}},"訂單編號",-1),tt=t("th",null,"下單時間",-1),et=t("th",null,"付款時間",-1),st={key:0},ot={key:1},lt=t("th",null,"付款狀態",-1),nt={key:0,class:"text-success"},dt={key:1,class:"text-muted"},at=t("th",null,"總金額",-1),it=t("h3",null,"選購商品",-1),rt={class:"table"},ct=t("thead",null,[t("tr")],-1),ut={class:"text-end"},pt={class:"d-flex justify-content-end"},_t={class:"form-check"},ht={class:"form-check-label",for:"flexCheckDefault"},mt={key:0},bt={key:1},ft={class:"modal-footer"},gt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function yt(e,r,_,c,l,p){return s(),o("div",A,[t("div",U,[t("div",j,[R,t("div",B,[t("div",q,[t("div",H,[N,t("table",F,[l.tempOrder.user?(s(),o("tbody",z,[t("tr",null,[G,t("td",null,n(l.tempOrder.user.name),1)]),t("tr",null,[J,t("td",null,n(l.tempOrder.user.email),1)]),t("tr",null,[K,t("td",null,n(l.tempOrder.user.tel),1)]),t("tr",null,[Q,t("td",null,n(l.tempOrder.user.address),1)])])):f("",!0)])]),t("div",W,[X,t("table",Y,[t("tbody",null,[t("tr",null,[Z,t("td",null,n(l.tempOrder.id),1)]),t("tr",null,[tt,t("td",null,n(e.$filters.date(l.tempOrder.create_at)),1)]),t("tr",null,[et,t("td",null,[l.tempOrder.paid_date?(s(),o("span",st,n(e.$filters.date(l.tempOrder.paid_date)),1)):(s(),o("span",ot,"沒有記錄"))])]),t("tr",null,[lt,t("td",null,[l.tempOrder.is_paid?(s(),o("strong",nt,"已付款")):(s(),o("span",dt,"尚未付款"))])]),t("tr",null,[at,t("td",null,n(e.$filters.currency(l.tempOrder.total)),1)])])]),it,t("table",rt,[ct,t("tbody",null,[(s(!0),o(u,null,g(l.tempOrder.products,a=>(s(),o("tr",{key:a.id},[t("th",null,n(a.product.title),1),t("td",null,n(a.qty)+" / "+n(a.product.unit),1),t("td",ut,n(e.$filters.currency(a.final_total)),1)]))),128))])]),t("div",pt,[t("div",_t,[M(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":r[0]||(r[0]=a=>l.tempOrder.is_paid=a)},null,512),[[v,l.tempOrder.is_paid]]),t("label",ht,[l.tempOrder.is_paid?(s(),o("span",mt,"已付款")):(s(),o("span",bt,"未付款"))])])])])])]),t("div",ft,[gt,t("button",{type:"button",class:"btn btn-primary",onClick:r[1]||(r[1]=a=>e.$emit("update-paid",l.tempOrder,"modal"))}," 修改付款狀態 ")])])])],512)}const kt=O(L,[["render",yt]]),{VITE_API:Ot,VITE_PATH:Mt}={VITE_API:"https://vue3-course-api.hexschool.io/v2/",VITE_PATH:"weekhomeworks",BASE_URL:"/Vue-Homework-Vite",MODE:"production",DEV:!1,PROD:!0,SSR:!1},vt={data(){return{tempOrder:{}}},methods:{openOrderModal(e){this.tempOrder={...e},this.$refs.orderModal.openModal()},updatePaid(e,r){const _=this.orders.find(c=>c.id===e.id);if(r==="modal"&&_.is_paid===e.is_paid){this.$refs.orderModal.hideModal();return}this.loadings.pageLoading=!0,this.$http.put(`${Ot}api/${Mt}/admin/order/${e.id}`,{data:{is_paid:e.is_paid}}).then(c=>{this.$refs.orderModal.hideModal(),this.loadings.pageLoading=!1,this.getOrders(this.pagination.current_page),this.triggerToast("success","已變更付款狀態")}).catch(c=>{this.loadings.pageLoading=!1,this.triggerToast("error",c.response.data.message)})},...h(D,["createDeleteModalRef","openModal"]),...h(k,["getOrders"]),...h(I,["triggerToast"])},computed:{...y(k,["orders","pagination"]),...y(E,["loadings"])},mounted(){const e=this.$refs.deleteModal;this.createDeleteModalRef(e,"訂單"),this.getOrders()},components:{orderModal:kt,deleteModal:S,pagination:T}},$t={class:"table mt-4"},xt=t("thead",null,[t("tr",null,[t("th",null,"購買時間"),t("th",null,"Email"),t("th",null,"購買款項"),t("th",null,"應付金額"),t("th",null,"是否付款"),t("th",null,"編輯")])],-1),Ct=["textContent"],wt={class:"list-unstyled"},Vt={class:"text-right"},Et={class:"form-check form-switch"},Pt=["id","onUpdate:modelValue","onChange"],St=["for"],Dt={key:0},Tt={key:1},It={class:"btn-group"},Lt=["onClick"],At=["onClick"];function Ut(e,r,_,c,l,p){const a=b("pagination"),$=b("order-modal"),x=b("delete-modal");return s(),o(u,null,[t("table",$t,[xt,t("tbody",null,[(s(!0),o(u,null,g(e.orders,(d,C)=>(s(),o(u,{key:C},[e.orders.length?(s(),o("tr",{key:0,class:P({"text-secondary":!d.is_paid})},[t("td",null,n(e.$filters.date(d.create_at)),1),t("td",null,[d.user?(s(),o("span",{key:0,textContent:n(d.user.email)},null,8,Ct)):f("",!0)]),t("td",null,[t("ul",wt,[(s(!0),o(u,null,g(d.products,(i,w)=>(s(),o("li",{key:w},n(i.product.title)+" 數量："+n(i.qty)+" "+n(i.product.unit),1))),128))])]),t("td",Vt,n(d.total),1),t("td",null,[t("div",Et,[M(t("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${d.id}`,"onUpdate:modelValue":i=>d.is_paid=i,onChange:i=>p.updatePaid(d)},null,40,Pt),[[v,d.is_paid]]),t("label",{class:"form-check-label",for:`paidSwitch${d.id}`},[d.is_paid?(s(),o("span",Dt,"已付款")):(s(),o("span",Tt,"未付款"))],8,St)])]),t("td",null,[t("div",It,[t("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:i=>p.openOrderModal(d)}," 檢視 ",8,Lt),t("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:i=>e.openModal("delete",d)}," 刪除 ",8,At)])])],2)):f("",!0)],64))),128))])]),m(a,{"page-obj":e.pagination,onEmitPage:e.getOrders},null,8,["page-obj","onEmitPage"]),m($,{ref:"orderModal",order:l.tempOrder,onUpdatePaid:p.updatePaid},null,8,["order","onUpdatePaid"]),m(x,{ref:"deleteModal"},null,512)],64)}const Nt=O(vt,[["render",Ut]]);export{Nt as default};
